<!doctype html>
<meta charset="utf-8">
<title>Diskografi-konvertering</title>
<h1>Last opp CSV</h1>
<form id="f" method="post" action="/convert" enctype="multipart/form-data">
  <label>Velg CSV-fil: <input type="file" name="csv" accept=".csv" required></label><br><br>
  <label>Velg funksjon:
    <select name="function" required>
      <option value="runMX">runMX</option>
      <option value="runRL">runRL</option>
      <option value="AllNames">AllNames</option>
    </select>
  </label><br><br>
  <button type="submit">Execute</button>
</form>
<script>
  document.getElementById('f').addEventListener('submit', e => {
    // lar nettleseren laste ned svaret som fil
    e.preventDefault();
    const form = e.target;
    const formData = new FormData(form);

    fetch(form.action, {
      method: form.method,
      body: formData
    })
    .then(response => {
      if (!response.ok) throw new Error('Nettverksfeil');
      return response.blob();
    })
    .then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.style.display = 'none';
      a.href = url;
      a.download = 'result.csv';
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
    })
    .catch(error => alert('Noe gikk galt: ' + error.message));
  });
</script>
